import{s}from"./notifications-D-zVtaEK.js";import{l as t}from"./index-Dj5MW5Ri.js";class i{static instance;sessionData=null;sessionTimeout=18e5;activityTimer=null;constructor(){this.setupActivityListener()}static getInstance(){return i.instance||(i.instance=new i),i.instance}setupActivityListener(){"undefined"!=typeof window&&["mousedown","keydown","scroll","touchstart"].forEach((s=>{window.addEventListener(s,(()=>this.updateLastActivity()))}))}updateLastActivity(){this.sessionData&&(this.sessionData.lastActivity=Date.now(),this.checkSessionTimeout())}checkSessionTimeout(){this.activityTimer&&clearTimeout(this.activityTimer),this.activityTimer=setTimeout((async()=>{this.sessionData&&Date.now()-this.sessionData.lastActivity>this.sessionTimeout&&(t.info("Session timed out due to inactivity"),await this.clearSession(),window.location.href="/LoginPage")}),this.sessionTimeout)}async initSession(s){this.sessionData={user:s,lastActivity:Date.now()},this.checkSessionTimeout(),t.info("Session initialized",{userId:s.id})}async clearSession(){try{await s.auth.signOut(),this.sessionData=null,this.activityTimer&&(clearTimeout(this.activityTimer),this.activityTimer=null),t.info("Session cleared")}catch(i){throw t.error("Error clearing session",i),i}}getUser(){return this.sessionData?.user||null}isAuthenticated(){return!!this.sessionData?.user}async refreshSession(){try{const{data:{session:t}}=await s.auth.getSession();if(!t)return void(await this.clearSession());const{data:i,error:e}=await s.from("users").select("*").eq("id",t.user.id).single();if(e||!i)throw e||new Error("User data not found");await this.initSession(i)}catch(i){t.error("Error refreshing session",i),await this.clearSession()}}async updateUserData(i){if(!this.sessionData?.user)throw new Error("No active session");try{const{error:e}=await s.from("users").update(i).eq("id",this.sessionData.user.id);if(e)throw e;this.sessionData.user={...this.sessionData.user,...i},t.info("User data updated",{userId:this.sessionData.user.id})}catch(e){throw t.error("Error updating user data",e),e}}}const e=i.getInstance();export{e as s};
