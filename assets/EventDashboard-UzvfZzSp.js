import{j as e,l as s,L as t}from"./index-CNBhnEaq.js";import{r as a,u as r}from"./react-vendor-BU_GpymC.js";import{s as n,n as l}from"./notifications-GebQcT5-.js";import{P as i,a as o,T as d}from"./trash-2-CZWBVrde.js";import{U as c}from"./users-RtvS6NlL.js";import{c as m}from"./createLucideIcon-BUt5drnH.js";import{S as x}from"./search-DSs--sQl.js";import{C as u,a as h,F as g,b as p}from"./filter-CkEJxoLf.js";import{X as f}from"./x-CqEfdwBo.js";import{g as b}from"./dateTime-DjR-Qffo.js";import{M as v}from"./map-pin-Chj_tTAp.js";import{s as y}from"./session-DbMe381v.js";
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=m("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),j=m("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]),N=m("CircleUser",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),k=m("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),_=m("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),E=m("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]),C=m("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),D=m("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),M=m("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),U=m("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),z=m("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]),S=m("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),A={"super-admin":{label:"Super Admin",color:"bg-purple-600",description:"Full access to all features, including managing admins and permissions",canCreateEvents:!0,canEditEvents:!0,canDeleteEvents:!0,canCloneEvents:!0,canDisableEvents:!0,canManageUsers:!0,canViewAnalytics:!0,canManageAdmins:!0,canEditPermissions:!0,canBeModified:!1,canAccessMarketing:!0},admin:{label:"Admin",color:"bg-red-500",description:"Full access to all features except admin management",canCreateEvents:!0,canEditEvents:!0,canDeleteEvents:!0,canCloneEvents:!0,canDisableEvents:!0,canManageUsers:!0,canViewAnalytics:!0,canManageAdmins:!1,canEditPermissions:!1,canBeModified:!0,canAccessMarketing:!0},"marketing-supervisor":{label:"Marketing Supervisor",color:"bg-yellow-500",description:"Can create, edit, clone, disable and delete events",canCreateEvents:!0,canEditEvents:!0,canDeleteEvents:!0,canCloneEvents:!0,canDisableEvents:!0,canManageUsers:!1,canViewAnalytics:!0,canManageAdmins:!1,canEditPermissions:!1,canBeModified:!0,canAccessMarketing:!0},marketing:{label:"Marketing",color:"bg-blue-500",description:"Can create, edit, clone and disable events",canCreateEvents:!0,canEditEvents:!0,canDeleteEvents:!1,canCloneEvents:!0,canDisableEvents:!0,canManageUsers:!1,canViewAnalytics:!1,canManageAdmins:!1,canEditPermissions:!1,canBeModified:!0,canAccessMarketing:!0},"marketing-intern":{label:"Marketing Intern",color:"bg-green-500",description:"Can edit and clone events only",canCreateEvents:!1,canEditEvents:!0,canDeleteEvents:!1,canCloneEvents:!0,canDisableEvents:!1,canManageUsers:!1,canViewAnalytics:!1,canManageAdmins:!1,canEditPermissions:!1,canBeModified:!0,canAccessMarketing:!0}};
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function L({currentUser:s,role:t,onAddEvent:n,onManageUsers:l,onLogout:o,onUpdateProfile:d}){const[m,x]=a.useState(!1),u=a.useRef(null),h="super-admin"===t||"admin"===t,g=r(),p=A[t]?.canAccessMarketing;return a.useEffect((()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&x(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]),e.jsx("div",{className:"relative z-10 mb-8",children:e.jsx("header",{className:"bg-gradient-to-r from-[#9b1f62] to-[#3e3764] rounded-2xl shadow-xl",children:e.jsxs("div",{className:"relative max-w-7xl mx-auto px-6 py-4",children:[e.jsx("div",{className:"absolute inset-0 opacity-10",children:e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(45deg,#000_25%,transparent_25%,transparent_75%,#000_75%,#000),linear-gradient(45deg,#000_25%,transparent_25%,transparent_75%,#000_75%,#000)] bg-[length:60px_60px] bg-[position:0_0,30px_30px]"})}),e.jsxs("div",{className:"relative flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("h1",{className:"text-2xl font-light text-white tracking-wide flex items-center gap-2",children:e.jsx("span",{className:"font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-white/80",children:"Event Dashboard"})}),e.jsxs("div",{className:"hidden md:block pl-6 border-l border-white/10",children:[e.jsx("div",{className:"text-white/90 font-medium truncate max-w-[200px]",children:s.name||s.email}),e.jsx("div",{className:"text-xs text-white/60 uppercase tracking-wider font-medium",children:t})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[h&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:n,className:"flex items-center gap-2 px-4 py-2.5 rounded-full bg-white/15 text-white transition-all duration-200 \r\n                    shadow-[0_2px_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)] \r\n                    hover:shadow-[0_1px_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)] \r\n                    hover:translate-y-[1px] hover:bg-white/20 active:translate-y-[2px] \r\n                    active:shadow-[0_0_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)]",children:[e.jsx(i,{size:18,className:"transition-transform duration-200"}),e.jsx("span",{className:"hidden sm:block font-medium",children:"New Event"})]}),e.jsxs("button",{onClick:l,className:"flex items-center gap-2 px-4 py-2.5 rounded-full bg-white/15 text-white transition-all duration-200 \r\n                    shadow-[0_2px_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)] \r\n                    hover:shadow-[0_1px_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)] \r\n                    hover:translate-y-[1px] hover:bg-white/20 active:translate-y-[2px] \r\n                    active:shadow-[0_0_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)]",children:[e.jsx(c,{size:18,className:"transition-transform duration-200"}),e.jsx("span",{className:"hidden sm:block font-medium",children:"Users"})]})]}),p&&e.jsxs("button",{onClick:()=>g("/communication/leads"),className:"flex items-center gap-2 px-4 py-2.5 rounded-full bg-white/15 text-white transition-all duration-200 \r\n                  shadow-[0_2px_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)] \r\n                  hover:shadow-[0_1px_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)] \r\n                  hover:translate-y-[1px] hover:bg-white/20 active:translate-y-[2px] \r\n                  active:shadow-[0_0_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)]",children:[e.jsx(D,{size:18,className:"transition-transform duration-200"}),e.jsx("span",{className:"hidden sm:block font-medium",children:"Communication"})]}),e.jsxs("div",{className:"relative",ref:u,children:[e.jsxs("button",{onClick:()=>x(!m),className:"relative flex items-center gap-2 px-4 py-2.5 rounded-full bg-white/15 text-white transition-all duration-200 \r\n                  shadow-[0_2px_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)] \r\n                  hover:shadow-[0_1px_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)] \r\n                  hover:translate-y-[1px] hover:bg-white/20 active:translate-y-[2px] \r\n                  active:shadow-[0_0_0_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.15)]",children:[e.jsx(N,{size:20,className:"transition-transform duration-200"}),e.jsx("span",{className:"hidden sm:block font-medium",children:s.name?.split(" ")[0]||"Profile"})]}),m&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded-xl bg-white shadow-xl border border-gray-100 overflow-hidden transform origin-top-right transition-all duration-200 z-50",children:[e.jsxs("div",{className:"md:hidden px-4 py-3 bg-gray-50 border-b border-gray-100",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:s.name||s.email}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:t})]}),e.jsxs("div",{className:"py-2",children:[d&&e.jsxs("button",{onClick:()=>{d(),x(!1)},className:"flex items-center gap-2 w-full px-4 py-2.5 text-sm text-gray-700 hover:bg-gray-50 transition-colors relative hover:shadow-[inset_0_1px_0_rgba(255,255,255,1),inset_0_-1px_0_rgba(0,0,0,0.05)] active:bg-gray-100",children:[e.jsx(N,{size:16}),e.jsx("span",{className:"font-medium",children:"Update Profile"})]}),e.jsxs("button",{onClick:o,className:"flex items-center gap-2 w-full px-4 py-2.5 text-sm text-red-600 hover:bg-red-50 transition-colors relative hover:shadow-[inset_0_1px_0_rgba(255,255,255,1),inset_0_-1px_0_rgba(0,0,0,0.05)] active:bg-red-100",children:[e.jsx(C,{size:16}),e.jsx("span",{className:"font-medium",children:"Sign Out"})]})]})]})]})]})]})]})})})}const P=[{value:"all",label:"All Events"},{value:"active",label:"Active Events"},{value:"disabled",label:"Disabled Events"}],R=[{value:"all",label:"All Time"},{value:"today",label:"Today"},{value:"week",label:"Next 7 Days"},{value:"month",label:"Next 30 Days"},{value:"year",label:"Next Year"}],q={status:"all",date:"all",upcoming:!1};function T({value:s,onChange:t,onFilterChange:r}){const[n,l]=a.useState(q),[i,o]=a.useState(!1),[d,c]=a.useState(!1),m=a.useRef(null),g=a.useRef(null);a.useEffect((()=>{const e=e=>{m.current&&!m.current.contains(e.target)&&o(!1),g.current&&!g.current.contains(e.target)&&c(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);const p=(e,s)=>{const t={...n,[e]:s};l(t),r(t)},b=()=>{let e=0;return"all"!==n.status&&e++,"all"!==n.date&&e++,n.upcoming&&e++,e};return e.jsxs("div",{className:"w-full max-w-4xl mx-auto mb-8 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(x,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-white/50"}),e.jsx("input",{type:"text",value:s,onChange:e=>t(e.target.value),placeholder:"Search events by title, location, or region...",className:"w-full pl-12 pr-4 py-3 bg-white/10 rounded-xl text-white placeholder-white/50 \r\n                   focus:outline-none focus:ring-2 focus:ring-white/20 focus:bg-white/15 transition-all"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs("div",{className:"relative",ref:m,children:[e.jsxs("button",{onClick:()=>{o(!i),c(!1)},className:"px-4 py-2 rounded-lg flex items-center gap-2 transition-all\n              "+(i||"all"!==n.status?"bg-white/20 text-white":"bg-white/10 text-white hover:bg-white/15"),children:[e.jsx("span",{className:"text-sm",children:"Status"}),"all"!==n.status&&e.jsx("span",{className:"bg-white/20 text-white text-xs px-1.5 py-0.5 rounded-full",children:"active"===n.status?"Active":"Disabled"})]}),i&&e.jsx("div",{className:"absolute left-0 mt-2 py-2 w-48 bg-white rounded-xl shadow-xl z-50 animate-slideIn origin-top",children:P.map((s=>e.jsxs("button",{onClick:()=>{p("status",s.value),o(!1)},className:"w-full px-4 py-2 text-sm text-left text-gray-700 hover:bg-gray-100 flex items-center justify-between",children:[s.label,n.status===s.value&&e.jsx(j,{className:"w-4 h-4 text-purple-600"})]},s.value)))})]}),e.jsxs("div",{className:"relative",ref:g,children:[e.jsxs("button",{onClick:()=>{c(!d),o(!1)},className:"px-4 py-2 rounded-lg flex items-center gap-2 transition-all\n              "+(d||"all"!==n.date?"bg-white/20 text-white":"bg-white/10 text-white hover:bg-white/15"),children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:R.find((e=>e.value===n.date))?.label||"Date"})]}),d&&e.jsx("div",{className:"absolute left-0 mt-2 py-2 w-48 bg-white rounded-xl shadow-xl z-50 animate-slideIn origin-top",children:R.map((s=>e.jsxs("button",{onClick:()=>{p("date",s.value),c(!1)},className:"w-full px-4 py-2 text-sm text-left text-gray-700 hover:bg-gray-100 flex items-center justify-between",children:[s.label,n.date===s.value&&e.jsx(j,{className:"w-4 h-4 text-purple-600"})]},s.value)))})]}),e.jsxs("button",{onClick:()=>p("upcoming",!n.upcoming),className:"px-4 py-2 rounded-lg flex items-center gap-2 transition-all\n            "+(n.upcoming?"bg-white/20 text-white":"bg-white/10 text-white hover:bg-white/15"),children:[e.jsx(h,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Upcoming"})]}),b()>0&&e.jsxs("button",{onClick:()=>{l(q),r(q),o(!1),c(!1)},className:"px-4 py-2 text-sm text-white/70 hover:text-white flex items-center gap-2 transition-colors ml-auto",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{children:"Clear filters"})]})]}),b()>0&&e.jsxs("div",{className:"text-sm text-white/50",children:[b()," ",1===b()?"filter":"filters"," applied"]})]})}function F({event:s,canModify:t,canDelete:a,canDuplicate:r,canToggleDisable:n,onDuplicate:l,onEdit:i,onDelete:c,onToggleDisable:m,disableLoading:x,isAdmin:h}){return e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-lg sm:rounded-xl shadow-lg overflow-hidden transition-all duration-200 \n    "+(s.disabled?"opacity-60":"hover:bg-white/15 hover:shadow-xl"),children:[s.image&&e.jsxs("div",{className:"relative h-32 sm:h-40 overflow-hidden rounded-t-lg sm:rounded-t-xl",children:[e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover"}),s.disabled&&e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center",children:e.jsx("span",{className:"text-xs sm:text-sm text-white font-medium",children:"Event Disabled"})})]}),e.jsxs("div",{className:"p-3 sm:p-4",children:[e.jsx("h3",{className:"text-sm sm:text-base font-semibold text-white mb-2 sm:mb-3 line-clamp-2",children:s.title}),e.jsx("div",{className:"space-y-2 sm:space-y-3",children:e.jsxs("div",{className:"space-y-2 sm:space-y-3 text-white/90",children:[e.jsx("div",{className:"space-y-2 sm:space-y-3",children:e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(u,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mt-0.5 text-white/70 flex-shrink-0"}),e.jsx("div",{className:"text-xs sm:text-sm",children:b(s.start_date,s.start_time,s.end_date,s.end_time)})]})}),s.venue&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(v,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mt-0.5 text-white/70 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm line-clamp-1",children:s.venue})]}),s.region&&e.jsxs("div",{className:"flex items-start gap-1",children:[e.jsx(_,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mt-0.5 text-white/70 flex-shrink-0"}),e.jsx("span",{className:"text-xs sm:text-sm",children:s.region})]})]})}),h&&e.jsx("div",{className:"mt-3 sm:mt-4 pt-2 sm:pt-3 border-t border-white/10 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[t&&e.jsx("button",{onClick:i,className:"p-1 sm:p-1.5 text-white/90 hover:bg-white/10 rounded transition-colors",title:"Edit Event",children:e.jsx(o,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),r&&e.jsx("button",{onClick:l,className:"p-1 sm:p-1.5 text-white/90 hover:bg-white/10 rounded transition-colors",title:"Duplicate Event",children:e.jsx(k,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),n&&e.jsx("button",{onClick:m,disabled:x===s.id,className:"p-1 sm:p-1.5 text-white/90 hover:bg-white/10 rounded transition-colors\n                    "+(x===s.id?"opacity-50 cursor-not-allowed":""),title:s.disabled?"Enable Event":"Disable Event",children:x===s.id?e.jsx("div",{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 border-2 border-t-transparent border-white rounded-full animate-spin"}):e.jsx(M,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})}),a&&e.jsx("button",{onClick:c,className:"p-1 sm:p-1.5 text-white/90 hover:bg-white/10 rounded transition-colors",title:"Delete Event",children:e.jsx(d,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})})]})]})}function I({events:s,onDuplicate:t,onEdit:a,onDelete:r,onToggleDisable:n,disableLoading:l,currentUserRole:i}){const o=A[i];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4 lg:gap-6",children:s.map((s=>e.jsx(F,{event:s,canModify:o.canEditEvents,canDelete:o.canDeleteEvents,canDuplicate:o.canCloneEvents,canToggleDisable:o.canDisableEvents,onEdit:()=>a(s.id),onDelete:()=>r(s.id),onDuplicate:()=>t(s.id),onToggleDisable:()=>n(s.id),disableLoading:l,isAdmin:o.canEditEvents||o.canDeleteEvents||o.canCloneEvents||o.canDisableEvents},s.id)))})}function V({users:t,currentUser:r,onClose:n,onUpdateRole:l,onDeleteUser:i,onResetPassword:o,onViewDetails:c,usersLoading:m}){const[u,h]=a.useState(""),[b,v]=a.useState(""),[y]=a.useState({field:"email",direction:"asc"}),[j,N]=a.useState(null),[k,_]=a.useState(null),[C,D]=a.useState(null),M=a.useRef(null),U="super-admin"===r.role,L=e=>e.split("-").map((e=>e[0].toUpperCase())).join(""),P=e=>{const s=A[e];if(!s)return"#6b7280";return{"bg-purple-600":"#8b5cf6","bg-red-500":"#ef4444","bg-yellow-500":"#eab308","bg-blue-500":"#3b82f6","bg-green-500":"#22c55e"}[s.color]||"#6b7280"};a.useEffect((()=>{const e=e=>{C&&M.current&&!M.current.contains(e.target)&&D(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[C]);const R=t.filter((e=>{const s=""===u||e.email.toLowerCase().includes(u.toLowerCase())||e.name&&e.name.toLowerCase().includes(u.toLowerCase()),t=""===b||e.role===b;return s&&t})).sort(((e,s)=>{const t=y.field;return("asc"===y.direction?1:-1)*(e[t]??"").toString().localeCompare((s[t]??"").toString())})),q=async e=>{const s=t.find((s=>s.id===e));s&&(U||"admin"!==s.role)&&s.id!==r.id&&_({userId:s.id,email:s.email})},T=e=>{if(e.id===r.id)return!1;if("super-admin"===e.role){if("super-admin"!==r.role)return!1;if(!A[e.role].canBeModified)return!1}return"admin"!==e.role||"super-admin"===r.role};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-start sm:items-center justify-center p-2 sm:p-4 bg-black/40 backdrop-blur overflow-y-auto",children:[e.jsxs("div",{className:"w-full max-w-6xl bg-white rounded-xl shadow-xl overflow-hidden my-2 sm:my-0 flex flex-col max-h-[98vh] sm:max-h-[90vh]",children:[e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4 bg-gradient-to-r from-[#9b1f62] to-[#3e3764] flex-shrink-0",children:[e.jsx("h2",{className:"text-white text-base sm:text-lg font-semibold",children:"User Management"}),e.jsx("button",{onClick:n,className:"text-white hover:opacity-80 transition-opacity p-1",children:e.jsx(f,{size:18})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 p-3 sm:p-4 border-b flex-shrink-0",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(x,{size:16,className:"absolute left-3 top-2.5 text-gray-400"}),e.jsx("input",{value:u,onChange:e=>h(e.target.value),placeholder:"Search users...",className:"w-full pl-10 pr-10 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-[#9b1f62] focus:border-[#9b1f62] transition-all text-gray-900 bg-white"}),u&&e.jsx("button",{onClick:()=>h(""),className:"absolute right-3 top-2.5 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(f,{size:14})})]}),e.jsxs("div",{className:"relative w-full sm:w-48",children:[e.jsx(g,{size:16,className:"absolute left-3 top-2.5 text-gray-400 z-10"}),e.jsxs("select",{value:b,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-8 py-2 text-sm border rounded-lg focus:ring-2 focus:ring-[#9b1f62] focus:border-[#9b1f62] appearance-none bg-white transition-all text-gray-900",children:[e.jsx("option",{value:"",className:"text-gray-900",children:"All roles"}),Object.entries(A).map((([s,t])=>e.jsx("option",{value:s,className:"text-gray-900",children:t.label},s)))]}),e.jsx(p,{size:14,className:"absolute right-3 top-2.5 text-gray-400 pointer-events-none"})]})]}),e.jsxs("div",{className:"flex-1 overflow-auto min-h-0",children:[e.jsxs("div",{className:"hidden sm:block",children:[" ",e.jsxs("table",{className:"min-w-full table-fixed text-sm",children:[e.jsx("thead",{className:"text-left text-gray-600 bg-gray-50 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-3 px-6 font-medium w-1/2",children:"User"}),e.jsx("th",{className:"py-3 px-6 font-medium w-1/3",children:"Email"}),e.jsx("th",{className:"py-3 px-6 font-medium text-center w-1/6",children:"Actions"})]})}),e.jsx("tbody",{className:"text-gray-700 divide-y divide-gray-100",children:m?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-8 text-center text-gray-500",children:"Loading users..."})}):0===R.length?e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-8 text-center text-gray-500",children:"No users found"})}):R.map((t=>{const a=A[t.role],n=P(t.role),i=t.id===r.id;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"py-4 px-6 w-1/2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative group flex-shrink-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-semibold shadow-sm",style:{backgroundColor:n},children:L(t.role)}),e.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-2 py-1 text-xs bg-gray-800 text-white rounded shadow-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none z-20",children:a?.label})]}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2",children:[e.jsx("span",{className:"truncate",children:t.name||"—"}),i&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full flex-shrink-0",children:"You"})]}),e.jsx("div",{className:"text-xs text-gray-500 truncate",children:a?.label})]})]})}),e.jsx("td",{className:"py-4 px-6 w-1/3",children:e.jsx("div",{className:"text-gray-900 truncate",title:t.email,children:t.email})}),e.jsx("td",{className:"py-4 px-6 w-1/6",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>c(t),className:"p-2 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-all flex-shrink-0",title:"View details",children:e.jsx(S,{size:16})}),e.jsx("button",{onClick:()=>o(t.email),className:"p-2 hover:bg-yellow-50 hover:text-yellow-600 rounded-lg transition-all flex-shrink-0",title:"Reset password",children:e.jsx(E,{size:16})}),U&&!i&&e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),D(C===t.id?null:t.id)},className:"p-2 hover:bg-purple-50 hover:text-purple-600 rounded-lg transition-all",title:"Change role",disabled:j===t.id,children:j===t.id?e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-purple-600 border-t-transparent rounded-full"}):e.jsx(z,{size:16})}),C===t.id&&e.jsxs("div",{ref:M,className:"absolute right-0 top-full mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-30 py-1",children:[e.jsx("div",{className:"px-3 py-2 text-xs text-gray-500 font-medium border-b",children:"Change Role"}),Object.entries(A).map((([a,r])=>e.jsxs("button",{onClick:async()=>{if(t.role!==a){N(t.id);try{await l(t.id,a)}catch(e){s.error("Error updating role:",e),alert("Failed to update role. Please try again.")}finally{N(null)}}D(null)},className:"flex items-center w-full text-left px-3 py-2 text-sm hover:bg-gray-50 transition-colors text-gray-900 "+(t.role===a?"bg-gray-100 font-medium":""),children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full mr-3",style:{backgroundColor:P(a)}}),r.label,t.role===a&&e.jsx("span",{className:"ml-auto text-xs text-gray-500",children:"Current"})]},a)))]})]}),e.jsx("button",{onClick:()=>q(t.id),disabled:!T(t),className:"p-2 rounded-lg transition-all flex-shrink-0 "+(T(t)?"hover:bg-red-50 hover:text-red-600 text-gray-400":"opacity-40 cursor-not-allowed text-gray-300"),title:T(t)?"Delete user":i?"Cannot delete your own account":"Only super-admins can delete admins",children:e.jsx(d,{size:16})})]})})]},t.id)}))})]})]}),e.jsx("div",{className:"block sm:hidden",children:m?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"Loading users..."}):0===R.length?e.jsx("div",{className:"py-8 text-center text-gray-500",children:"No users found"}):e.jsx("div",{className:"divide-y divide-gray-100",children:R.map((t=>{const a=A[t.role],n=P(t.role),i=t.id===r.id;return e.jsxs("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[e.jsx("div",{className:"relative group flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-white text-sm font-semibold shadow-sm",style:{backgroundColor:n},children:L(t.role)})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-medium text-gray-900 flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"truncate",children:t.name||"—"}),i&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full flex-shrink-0",children:"You"})]}),e.jsx("div",{className:"text-sm text-gray-600 truncate mb-1",children:t.email}),e.jsx("div",{className:"text-xs text-gray-500",children:a?.label})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 border-t pt-3",children:[e.jsxs("button",{onClick:()=>c(t),className:"flex items-center justify-center gap-2 px-3 py-2 hover:bg-blue-50 hover:text-blue-600 rounded-lg transition-all text-sm text-gray-600 border border-gray-200",children:[e.jsx(S,{size:16}),e.jsx("span",{children:"View Details"})]}),e.jsxs("button",{onClick:()=>o(t.email),className:"flex items-center justify-center gap-2 px-3 py-2 hover:bg-yellow-50 hover:text-yellow-600 rounded-lg transition-all text-sm text-gray-600 border border-gray-200",children:[e.jsx(E,{size:16}),e.jsx("span",{children:"Reset Password"})]}),U&&!i&&e.jsx("button",{onClick:e=>{e.stopPropagation(),D(C===t.id?null:t.id)},className:"flex items-center justify-center gap-2 px-3 py-2 hover:bg-purple-50 hover:text-purple-600 rounded-lg transition-all text-sm text-gray-600 border border-gray-200",disabled:j===t.id,children:j===t.id?e.jsx("div",{className:"animate-spin w-4 h-4 border-2 border-purple-600 border-t-transparent rounded-full"}):e.jsxs(e.Fragment,{children:[e.jsx(z,{size:16}),e.jsx("span",{children:"Change Role"})]})}),e.jsxs("button",{onClick:()=>q(t.id),disabled:!T(t),className:"flex items-center justify-center gap-2 px-3 py-2 rounded-lg transition-all text-sm border "+(T(t)?"hover:bg-red-50 hover:text-red-600 text-gray-600 border-gray-200":"opacity-40 cursor-not-allowed text-gray-400 border-gray-100 bg-gray-50"),title:T(t)?"Delete user":i?"Cannot delete your own account":"Only super-admins can delete admins",children:[e.jsx(d,{size:16}),e.jsx("span",{children:"Delete User"})]})]}),C===t.id&&e.jsxs("div",{ref:M,className:"fixed inset-x-4 bottom-4 bg-white border border-gray-200 rounded-lg shadow-lg z-30 py-1 max-w-sm mx-auto",children:[e.jsxs("div",{className:"px-3 py-2 text-xs text-gray-500 font-medium border-b flex items-center justify-between",children:[e.jsx("span",{children:"Change Role"}),e.jsx("button",{onClick:()=>D(null),className:"p-1 hover:bg-gray-100 rounded-full",children:e.jsx(f,{size:14})})]}),Object.entries(A).map((([a,r])=>e.jsxs("button",{onClick:async()=>{if(t.role!==a){N(t.id);try{await l(t.id,a)}catch(e){s.error("Error updating role:",e),alert("Failed to update role. Please try again.")}finally{N(null)}}D(null)},className:"flex items-center w-full text-left px-3 py-2.5 text-sm hover:bg-gray-50 transition-colors text-gray-900 "+(t.role===a?"bg-gray-100 font-medium":""),children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full mr-3",style:{backgroundColor:P(a)}}),r.label,t.role===a&&e.jsx("span",{className:"ml-auto text-xs text-gray-500",children:"Current"})]},a)))]})]},t.id)}))})})]}),!m&&e.jsxs("div",{className:"px-4 sm:px-6 py-3 sm:py-4 bg-gray-50 border-t flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-0 text-xs sm:text-sm text-gray-600 flex-shrink-0",children:[e.jsx("span",{children:R.length===t.length?`Showing all ${t.length} users`:`Showing ${R.length} of ${t.length} users`}),e.jsxs("div",{className:"bg-[#9b1f62]/10 text-[#9b1f62] px-3 py-1 rounded-full text-xs font-medium",children:["Total: ",t.length]})]})]}),k&&e.jsx("div",{className:"fixed inset-0 z-60 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full p-4 sm:p-6 m-2",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Delete User"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:"This action cannot be undone"})]})]}),e.jsxs("p",{className:"text-sm sm:text-base text-gray-700 mb-6",children:["Are you sure you want to delete ",e.jsx("strong",{children:k.email}),"? This will permanently remove their account and all associated data."]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-3 justify-end",children:[e.jsx("button",{onClick:()=>_(null),className:"w-full sm:w-auto px-4 py-2 text-sm text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(k)try{i(k.userId),_(null)}catch(e){s.error("Error deleting user:",e)}},className:"w-full sm:w-auto px-4 py-2 text-sm bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:"Delete User"})]})]})})]})}const $=e=>{if(!e||isNaN(new Date(e).getTime()))return"Never";const s=new Date(e);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!0}).format(s)};function O({user:s,currentUser:t,onClose:r,onResetPassword:n,onDeleteUser:l}){const[i,o]=a.useState(!1);if(!s||!s.email)return null;const c=A[s.role],m=c?.color.replace("bg-","text-").replace("-600","-700");return e.jsxs("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-50 flex items-center justify-center p-2 sm:p-4",children:[e.jsxs("div",{className:"w-full max-w-3xl bg-white rounded-xl shadow-xl overflow-hidden animate-fadeIn my-2 sm:my-0",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#9b1f62] to-[#3e3764] px-4 sm:px-6 py-4 flex justify-between items-start sm:items-center",children:[e.jsxs("div",{className:"flex items-start sm:items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center ${c?.color} shadow-lg`,children:e.jsx(N,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:s.name||s.email}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${m} bg-white/10`,children:c?.label||s.role}),s.id===t.id&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-700",children:"You"})]})]})]}),e.jsx("button",{onClick:r,className:"text-white/80 hover:text-white transition-colors p-1 hover:bg-white/10 rounded-lg",children:e.jsx(f,{size:20})})]}),e.jsx("div",{className:"max-h-[calc(85vh-8rem)] overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(N,{className:"w-4 h-4"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Full Name"}),e.jsx("span",{className:"text-base font-medium text-gray-900 mt-1",children:s.name||"Not provided"})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Email Address"}),e.jsx("span",{className:"text-base font-medium text-gray-900 mt-1 break-all",children:s.email})]})})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-4 h-4"}),"Role & Permissions"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 mb-4 pb-3 border-b border-gray-200",children:[e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-lg ${c?.color} bg-opacity-10`,children:[e.jsx(U,{className:`w-4 h-4 ${m}`}),e.jsx("span",{className:`text-sm font-medium ${m}`,children:c?.label||s.role})]}),e.jsx("span",{className:"text-xs text-gray-500",children:c?.description||"User role and associated permissions"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:s.role&&A[s.role]&&Object.entries(A[s.role]).filter((([e])=>e.startsWith("can"))).map((([s,t])=>e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center "+(t?"bg-green-100 text-green-600":"bg-red-100 text-red-600"),children:t?"✓":"✗"}),e.jsx("span",{className:"text-sm text-gray-700",children:s.replace(/^can/,"").replace(/([A-Z])/g," $1").trim()})]},s)))})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"Account Information"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Account Created"}),e.jsx("span",{className:"text-base font-medium text-gray-900 mt-1",children:$(s.created_at)})]})}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Last Sign In"}),e.jsx("span",{className:"text-base font-medium text-gray-900 mt-1",children:$(s.last_sign_in)})]})})]})]})]})}),e.jsxs("div",{className:"px-4 sm:px-6 py-4 bg-gray-50 border-t flex flex-col-reverse sm:flex-row gap-3 sm:gap-0 justify-between items-stretch sm:items-center",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsxs("button",{onClick:()=>n(s.email),className:"flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-yellow-700 bg-yellow-50 rounded-lg hover:bg-yellow-100 transition-colors",children:[e.jsx(E,{size:16}),"Reset Password"]}),(()=>{if(s.id===t.id)return!1;if("super-admin"===s.role){if("super-admin"!==t.role)return!1;if(!A[s.role].canBeModified)return!1}return"admin"!==s.role||"super-admin"===t.role})()&&e.jsxs("button",{onClick:()=>o(!0),className:"flex items-center justify-center gap-2 px-4 py-2 text-sm font-medium text-red-600 bg-red-50 rounded-lg hover:bg-red-100 transition-colors",children:[e.jsx(d,{size:16}),"Delete User"]})]}),e.jsx("button",{onClick:r,className:"w-full sm:w-auto flex items-center justify-center px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",children:"Close"})]})]}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-60 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl p-4 sm:p-6 w-full max-w-sm m-2 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(w,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Delete User"}),e.jsx("p",{className:"text-sm text-gray-500",children:"This action cannot be undone"})]})]}),e.jsxs("p",{className:"text-base text-gray-700 mb-6",children:["Are you sure you want to delete ",e.jsx("strong",{children:s.email}),"? This will permanently remove their account and all associated data."]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 justify-end",children:[e.jsx("button",{onClick:()=>o(!1),className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{l(s.id),o(!1)},className:"w-full sm:w-auto px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"Delete User"})]})]})})]})}class B{requests={};config;constructor(e){this.config=e}canMakeRequest(e){const s=Date.now();return this.requests[e]||(this.requests[e]=[]),this.requests[e]=this.requests[e].filter((e=>s-e<this.config.timeWindow)),this.requests[e].length<this.config.maxRequests&&(this.requests[e].push(s),!0)}getRemainingTime(e){if(!this.requests[e]||0===this.requests[e].length)return 0;const s=Math.min(...this.requests[e]),t=this.config.timeWindow-(Date.now()-s);return Math.max(0,t)}reset(e){delete this.requests[e]}}const H=new B({maxRequests:50,timeWindow:6e4}),W=new B({maxRequests:10,timeWindow:6e4});function Y(){const[i,o]=a.useState([]),[d,c]=a.useState([]),[m,x]=a.useState(null),[u,h]=a.useState(null),[g,p]=a.useState(!0),[f,b]=a.useState(!0),[v,w]=a.useState(!1),[j,N]=a.useState(null),[k,_]=a.useState(""),[E,C]=a.useState({status:"all",date:"all",upcoming:!1}),[D,M]=a.useState(null),U=r(),z="admin"===u||"super-admin"===u,S=z,P=async()=>{try{const{data:e,error:t}=await n.from("users").select("*").order("email");if(t)return s.error("Error fetching users:",t),void l.error("Failed to fetch users");if(e){const s=["super-admin","admin","marketing-supervisor","marketing","marketing-intern"],t=e.filter((e=>s.includes(e.role))).map((e=>({...e,role:e.role})));if(c(t),m){const e=t.find((e=>e.id===m.id));e&&x(e)}}}catch(e){s.error("Error fetching users:",e),l.error("Failed to fetch users")}};a.useEffect((()=>{(async()=>{try{await y.refreshSession();const e=y.getUser();if(!e)return void U("/LoginPage");h(e.role),x(e),await R(),await P()}catch(e){s.error("Error initializing dashboard",e),l.error("Failed to initialize dashboard"),U("/LoginPage")}finally{b(!1)}})()}),[U]),a.useEffect((()=>{const e=setInterval((()=>{m&&P()}),6e4);return()=>clearInterval(e)}),[m]);const R=async()=>{if(H.canMakeRequest("fetchEvents")){p(!0);try{const{data:e,error:t}=await n.from("events").select("*").order("start_date",{ascending:!0});if(t)return s.error("Failed to fetch events",t),void l.error("Failed to load events");e&&(s.debug("Raw Events Data:",{data:e}),o(e))}catch(e){s.error("Failed to fetch events",e),l.error("Failed to load events")}finally{p(!1)}}else{const e=H.getRemainingTime("fetchEvents");l.error(`Too many requests. Please wait ${Math.ceil(e/1e3)} seconds.`)}},q=async e=>{if(!confirm("Are you sure you want to delete this user? This action cannot be undone."))return;const t=d.find((s=>s.id===e));if(t){if("super-admin"===t.role){if("super-admin"!==m?.role)return void l.error("Only super-admins can delete super-admin users");if(!A[t.role].canBeModified)return void l.error("Super admin users cannot be modified")}if("admin"!==t.role||"super-admin"===m?.role)try{const{error:s}=await n.from("users").delete().eq("id",e);if(s)throw s;const{error:t}=await n.auth.admin.deleteUser(e);if(t)throw t;c(d.filter((s=>s.id!==e))),l.success("User deleted successfully")}catch(a){s.error("Error deleting user:",a),l.error("Failed to delete user. Please try again.")}else l.error("Only super-admins can delete admin users")}else l.error("User not found")},F=async e=>{if(confirm(`Send password reset email to ${e}?`))try{const{error:s}=await n.auth.resetPasswordForEmail(e,{redirectTo:window.location.origin+"/reset-password"});if(s)throw s;alert("Password reset email sent successfully!")}catch(t){s.error("Error sending password reset:",t),alert("Failed to send password reset email. Please try again.")}},$=i.map((e=>{let s=0;const t=k.toLowerCase(),a=new Date;if(a.setHours(0,0,0,0),"all"!==E.status){const s=e.disabled||!1;if("active"===E.status&&s)return null;if("disabled"===E.status&&!s)return null}if(E.upcoming){const s=new Date(e.start_date);if((e.end_date?new Date(e.end_date):s)<a)return null}if("all"!==E.date){const s=new Date(e.start_date),t=e.end_date?new Date(e.end_date):s,r=Math.floor((s.getTime()-a.getTime())/864e5);switch(E.date){case"today":if(0!==r)return null;break;case"week":if(r>7||t<a)return null;break;case"month":if(r>30||t<a)return null;break;case"year":if(r>365||t<a)return null}}return t&&(e.title?.toLowerCase().includes(t)&&(s+=3),e.location?.toLowerCase().includes(t)&&(s+=2),e.region?.toLowerCase().includes(t)&&(s+=2),e.start_date?.toLowerCase().includes(t)&&(s+=1),e.end_date?.toLowerCase().includes(t)&&(s+=1),0===s)?null:{...e,score:s||1}})).filter((e=>null!==e)).sort(((e,s)=>{if(s.score!==e.score)return s.score-e.score;const t=new Date(e.start_date),a=new Date(s.start_date);return t.getTime()-a.getTime()}));return s.debug("Detailed Filter Summary:",{totalEvents:i.length,filteredEvents:$.length,currentFilters:E,allEventTitles:i.map((e=>e.title))}),f?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-r from-[#9b1f62] via-[#682161] to-[#3e3764] text-white",children:e.jsx(t,{size:"lg"})}):(s.debug("Filtered events:",{filteredEvents:$}),s.debug("User role:",{role:u,isAdmin:z,canModify:S}),e.jsx("div",{className:"min-h-screen bg-gradient-to-r from-[#9b1f62] via-[#682161] to-[#3e3764] px-4 py-10 text-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(L,{currentUser:m,role:u,onAddEvent:()=>U("/Admin/events/new"),onManageUsers:()=>{P(),w(!0)},onLogout:async()=>{try{await y.clearSession(),U("/LoginPage")}catch(e){s.error("Error logging out",e),l.error("Failed to log out")}},onUpdateProfile:()=>{m&&N(m)}}),e.jsx(T,{value:k,onChange:_,onFilterChange:C}),g?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx(t,{size:"lg"})}):e.jsx(I,{events:$,currentUserRole:u||"",onDuplicate:async e=>{try{const{data:s,error:t}=await n.from("events").select("*").eq("id",e).single();if(t||!s)throw t;const a={...s,title:`${s.title} (Copy)`,start_date:(new Date).toISOString().split("T")[0],end_date:null};delete a.id;const{error:r}=await n.from("events").insert([a]);if(r)throw r;await R(),l.success("Event duplicated successfully!")}catch(t){s.error("Error duplicating event:",t),l.error("Failed to duplicate event. Please try again.")}},onEdit:e=>U(`/Admin/events/edit/${e}`),onDelete:async e=>{if(W.canMakeRequest("deleteEvent")){if(confirm("Are you sure you want to delete this event? This action cannot be undone."))try{const{error:t}=await n.from("events").delete().eq("id",e);if(t)throw t;o(i.filter((s=>s.id!==e))),l.success("Event deleted successfully"),s.info("Event deleted",{eventId:e})}catch(t){s.error("Error deleting event",t),l.error("Failed to delete event")}}else l.error("Please wait before trying to delete another event")},onToggleDisable:async e=>{if(W.canMakeRequest("toggleDisable")){M(e);try{const s=i.find((s=>s.id===e));if(!s)return void l.error("Event not found");const{error:t}=await n.from("events").update({disabled:!s.disabled}).eq("id",e);if(t)throw t;o(i.map((s=>s.id===e?{...s,disabled:!s.disabled}:s))),l.success(`Event ${s.disabled?"enabled":"disabled"} successfully`)}catch(t){s.error("Error toggling event status",t),l.error("Failed to update event status")}finally{M(null)}}else l.error("Please wait before toggling event status")},disableLoading:D}),v&&e.jsx(V,{users:d,currentUser:m,onClose:()=>w(!1),onUpdateRole:async(e,t)=>{if(!W.canMakeRequest("updateRole"))return void l.error("Please wait before updating another user's role");if("super-admin"!==m?.role)return void l.error("Only super-admins can change user roles");const a=d.find((s=>s.id===e));if(a)if("super-admin"!==a.role||A[a.role].canBeModified)try{const{error:a}=await n.from("users").update({role:t}).eq("id",e);if(a)throw a;c(d.map((s=>s.id===e?{...s,role:t}:s))),m?.id===e&&(h(t),x((e=>e?{...e,role:t}:null))),l.success("Role updated successfully"),s.info("User role updated",{userId:e,newRole:t})}catch(r){s.error("Error updating role",r),l.error("Failed to update role")}else l.error("Super admin users cannot be modified");else l.error("User not found")},onDeleteUser:q,onResetPassword:F,onViewDetails:e=>N(e),usersLoading:g}),j&&e.jsx(O,{user:j,currentUser:m,onClose:()=>{N(null),P()},onResetPassword:F,onDeleteUser:q})]})}))}export{Y as default};
