import{j as e,l as t}from"./index-CNBhnEaq.js";import{d as s,u as a,e as r,r as i}from"./react-vendor-BU_GpymC.js";import{s as n,n as l}from"./notifications-GebQcT5-.js";function o(){const{id:o}=s(),d=a(),m=Boolean(o);r();const[c,u]=i.useState({title:"",description:"",start_date:(new Date).toISOString().split("T")[0],start_time:"09:00",end_date:"",end_time:"17:00",venue:"",address:"",region:"",location:"",disabled:!1,is_virtual:!1,map_link:""}),[h,x]=i.useState([]),[b,p]=i.useState(!1),[w,g]=i.useState(!1),[f,v]=i.useState(null),[j,N]=i.useState(null),[y,_]=i.useState(!1),[k,E]=i.useState(null),[S,C]=i.useState(!1);i.useEffect((()=>{(async()=>{try{const{data:e,error:s}=await n.from("venues").select("*").order("name",{ascending:!0});if(s)return t.error("Error fetching venues:",s),void l.error("Failed to load venues");e&&x(e)}catch(e){t.error("Error:",e),l.error("Failed to load venues")}})()}),[]),i.useEffect((()=>{if(m){(async()=>{try{const{data:e,error:s}=await n.from("events").select("*").eq("id",o).single();if(s)return t.error("Error fetching event:",s),void l.error("Failed to load event");if(e){const t={...e,start_date:e.start_date?new Date(e.start_date).toISOString().split("T")[0]:"",end_date:e.end_date?new Date(e.end_date).toISOString().split("T")[0]:"",start_time:e.start_time||"09:00",end_time:e.end_time||"17:00",is_virtual:e.is_virtual||!1};u(t),g(e.is_virtual||!1),E(e.image||null);const s=h.find((t=>t.name===e.venue));p(s?.is_inhouse??!1)}}catch(e){t.error("Error:",e),l.error("Failed to load event")}})()}}),[o,m,h]),i.useEffect((()=>{(c.region||w)&&(u((e=>({...e,venue:"",address:""}))),p(!1))}),[c.region,w]);const D=e=>{const{name:t,value:s}=e.target;if("end_date"===t&&s&&c.start_date&&new Date(s)<new Date(c.start_date))alert("End date cannot be before start date");else{if("start_date"===t&&s&&c.end_date&&new Date(s)>new Date(c.end_date)&&u((e=>({...e,end_date:""}))),"end_time"===t&&c.start_date===c.end_date){const[e,t]=c.start_time.split(":").map(Number),[a,r]=s.split(":").map(Number);if(a<e||a===e&&r<=t)return void alert("End time must be after start time on the same day")}u((e=>({...e,[t]:s})))}},I=h.filter((e=>e.region===c.region&&e.is_inhouse));return e.jsx("div",{className:"min-h-screen bg-gradient-to-r from-[#9b1f62] via-[#682161] to-[#3e3764] py-4 sm:py-6 px-3 sm:px-4",children:e.jsx("div",{className:"max-w-3xl mx-auto",children:e.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-xl shadow-lg p-4 sm:p-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white text-center mb-4 sm:mb-6",children:m?"Edit Event":"Add New Event"}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!y){_(!0);try{const e=await(async()=>{if(!f)return k;const e=`${Date.now()}_${f.name}`,{data:s,error:a}=await n.storage.from("event-images").upload(e,f);if(a)return t.error("Image upload error:",a),null;const{data:r}=n.storage.from("event-images").getPublicUrl(e);return r?.publicUrl||null})(),s={title:c.title,description:c.description,start_date:new Date(c.start_date).toISOString(),end_date:c.end_date?new Date(c.end_date).toISOString():null,start_time:c.start_time,end_time:c.end_time,venue:w?"Virtual Event":c.venue,address:w?"N/A":c.address,region:w?"Virtual":c.region,image:e||k,disabled:c.disabled};if(t.info("Submitting event data:",{eventData:s}),m){const{data:e,error:a}=await n.from("events").update(s).eq("id",o);if(a)throw t.error("Error updating event:",a),t.error("Error details:",{code:a.code,message:a.message,details:a.details,hint:a.hint}),a;t.info("Update response:",{data:e}),l.success("Event updated successfully")}else{const{data:e,error:a}=await n.from("events").insert([s]).select();if(a)throw t.error("Error creating event:",a),t.error("Error details:",{code:a.code,message:a.message,details:a.details,hint:a.hint}),a;t.info("Insert response:",{data:e}),l.success("Event created successfully")}d("/EventDashboard")}catch(s){t.error("Full error object:",s),l.error(s.message||"Failed to save event")}finally{_(!1)}}},className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 sm:p-4",children:[e.jsx("label",{className:"text-white/90 font-medium mb-2 block text-sm sm:text-base",children:"Region *"}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:["Bangladesh","Australia"].map((t=>e.jsx("button",{type:"button",onClick:()=>{return e=t,u((t=>({...t,region:e,venue:"",address:""}))),void p(!1);var e},disabled:w,className:"px-4 py-2 sm:py-2.5 rounded-lg border text-white text-sm sm:text-base transition-all duration-200 "+(c.region===t?"bg-[#9b1f62] border-white shadow-lg transform scale-102":w?"bg-white/5 border-white/10 cursor-not-allowed opacity-50":"bg-white/10 border-white/20 hover:bg-white/20"),children:t},t)))})]}),e.jsx("div",{className:"bg-white/5 rounded-lg p-3 sm:p-4",children:e.jsxs("label",{className:"flex items-center justify-between cursor-pointer",children:[e.jsx("span",{className:"text-sm sm:text-base text-white/90 font-medium",children:"Virtual Event"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:e=>{g(e.target.checked),e.target.checked&&(u((e=>({...e,region:"",venue:"",address:""}))),p(!1))},className:"sr-only"}),e.jsx("div",{className:"block w-12 sm:w-14 h-7 sm:h-8 rounded-full transition-colors duration-200 "+(w?"bg-[#9b1f62]":"bg-white/20"),children:e.jsx("div",{className:"absolute left-1 top-1 bg-white w-5 sm:w-6 h-5 sm:h-6 rounded-full transition-transform duration-200 transform "+(w?"translate-x-5 sm:translate-x-6":"translate-x-0")})})]})]})}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 sm:p-4 space-y-3 sm:space-y-4",children:[e.jsx("h2",{className:"text-sm sm:text-base font-semibold text-white mb-2 sm:mb-3",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-white/90 font-medium mb-1 sm:mb-1.5 block text-sm",children:"Title *"}),e.jsx("input",{name:"title",value:c.title,onChange:D,required:!0,className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base placeholder-white/50 focus:border-white/40 focus:outline-none focus:ring-1 focus:ring-white/40",placeholder:"Enter event title"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-white/90 font-medium mb-1 sm:mb-1.5 block text-sm",children:"Description *"}),e.jsx("textarea",{name:"description",value:c.description,onChange:D,rows:3,required:!0,className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base placeholder-white/50 focus:border-white/40 focus:outline-none focus:ring-1 focus:ring-white/40",placeholder:"Enter event description"})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 sm:p-4 space-y-3 sm:space-y-4",children:[e.jsx("h2",{className:"text-sm sm:text-base font-semibold text-white mb-2 sm:mb-3",children:"Date and Time"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-white/90 font-medium mb-1 sm:mb-1.5 block text-sm",children:"Start Date *"}),e.jsx("input",{type:"date",name:"start_date",value:c.start_date,onChange:D,required:!0,min:(new Date).toISOString().split("T")[0],className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base focus:border-white/40 focus:outline-none focus:ring-1 focus:ring-white/40"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-white/90 font-medium mb-1 sm:mb-1.5 block text-sm",children:"Start Time *"}),e.jsx("input",{type:"time",name:"start_time",value:c.start_time,onChange:D,required:!0,className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base focus:border-white/40 focus:outline-none focus:ring-1 focus:ring-white/40"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-white/90 font-medium mb-1 sm:mb-1.5 block text-sm",children:["End Date",e.jsx("span",{className:"text-white/60 text-xs ml-1",children:"(Optional)"})]}),e.jsx("input",{type:"date",name:"end_date",value:c.end_date,onChange:D,min:c.start_date||(new Date).toISOString().split("T")[0],className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base focus:border-white/40 focus:outline-none focus:ring-1 focus:ring-white/40"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-white/90 font-medium mb-1 sm:mb-1.5 block text-sm",children:["End Time",e.jsx("span",{className:"text-white/60 text-xs ml-1",children:"(Optional)"})]}),e.jsx("input",{type:"time",name:"end_time",value:c.end_time,onChange:D,className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base focus:border-white/40 focus:outline-none focus:ring-1 focus:ring-white/40"})]})]})]}),!w&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 sm:p-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-0 mb-3 sm:mb-4",children:[e.jsx("h2",{className:"text-sm sm:text-base font-semibold text-white",children:"Venue Information"}),e.jsxs("label",{className:"flex items-center cursor-pointer",children:[e.jsx("span",{className:"text-xs sm:text-sm text-white/90 mr-2 sm:mr-3",children:"Inhouse Event"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:e=>{p(e.target.checked),e.target.checked||u((e=>({...e,venue:"",address:"",map_link:""})))},className:"sr-only"}),e.jsx("div",{className:"block w-12 sm:w-14 h-7 sm:h-8 rounded-full transition-colors duration-200 "+(b?"bg-[#9b1f62]":"bg-white/20"),children:e.jsx("div",{className:"absolute left-1 top-1 bg-white w-5 sm:w-6 h-5 sm:h-6 rounded-full transition-transform duration-200 transform "+(b?"translate-x-5 sm:translate-x-6":"translate-x-0")})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-white/90 font-medium mb-1 sm:mb-1.5 block text-sm",children:"Venue Name *"}),b?e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>C(!S),className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base text-left flex justify-between items-center focus:border-white/40 focus:outline-none focus:ring-1 focus:ring-white/40",children:[c.venue||`Select ${c.region} Venue`,e.jsx("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),S&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white rounded-lg shadow-lg max-h-48 overflow-auto",children:I.length>0?I.map((t=>e.jsx("button",{type:"button",onClick:()=>(e=>{const t=h.find((t=>t.name===e));u((s=>({...s,venue:e,address:t?.address||s.address,map_link:t?.map_link||""}))),C(!1)})(t.name),className:"w-full px-3 py-2 text-left text-sm sm:text-base text-gray-700 hover:bg-gray-100 first:rounded-t-lg last:rounded-b-lg transition-colors duration-200",children:t.name},t.id))):e.jsxs("div",{className:"px-3 py-2 text-sm sm:text-base text-gray-500 text-center",children:["No inhouse venues available in ",c.region]})})]}):e.jsx("input",{name:"venue",value:c.venue,onChange:D,required:!0,className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base placeholder-white/50 focus:border-white/40 focus:outline-none focus:ring-1 focus:ring-white/40",placeholder:`Enter venue name in ${c.region}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-white/90 font-medium mb-1 sm:mb-1.5 block text-sm",children:"Address *"}),e.jsx("input",{name:"address",value:c.address,onChange:D,required:!0,disabled:b,className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base placeholder-white/50 focus:border-white/40 focus:outline-none focus:ring-1 focus:ring-white/40 "+(b?"opacity-75 cursor-not-allowed":""),placeholder:b?"Address will be set automatically":"Enter venue address"})]}),b&&e.jsxs("div",{children:[e.jsxs("label",{className:"text-white/90 font-medium mb-1 sm:mb-1.5 block text-sm",children:["Map Link",e.jsx("span",{className:"text-white/60 text-xs ml-1",children:"(Set in venue settings)"})]}),e.jsx("input",{name:"map_link",value:c.map_link,readOnly:!0,disabled:!0,className:"w-full p-2 sm:p-2.5 rounded-lg bg-white/10 border border-white/20 text-white text-sm sm:text-base placeholder-white/50 opacity-75 cursor-not-allowed",placeholder:"Map link will be set automatically"})]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 sm:p-4",children:[e.jsx("h2",{className:"text-sm sm:text-base font-semibold text-white mb-3 sm:mb-4",children:"Event Image"}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-white/90 font-medium block mb-2 text-sm",children:["Upload Image",e.jsx("span",{className:"text-white/60 text-xs ml-2",children:"(500×500px)"})]}),j||k?e.jsxs("div",{className:"relative mx-auto h-[150px] sm:h-[200px] overflow-hidden border border-white/20 rounded-lg bg-white/5",children:[e.jsx("img",{src:j||k||"",alt:"Preview",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:()=>{v(null),N(null),k&&E(null)},className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white text-xs sm:text-sm px-2 py-1 rounded transition-colors duration-200",children:"Remove"})]}):e.jsxs("div",{className:"relative mx-auto border-2 border-dashed border-white/30 rounded-lg hover:border-white/50 transition-all bg-white/5 h-[150px] sm:h-[200px] flex items-center justify-center",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:e=>{const t=e.target.files?.[0];if(t){v(t);const e=new FileReader;e.onloadend=()=>{N(e.result)},e.readAsDataURL(t)}},required:!m,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),e.jsxs("div",{className:"text-center px-2",children:[e.jsx("svg",{className:"mx-auto h-8 w-8 sm:h-10 sm:w-10 text-white/70",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("p",{className:"mt-2 text-xs sm:text-sm text-white/80",children:"Click to upload or drag and drop"}),e.jsx("p",{className:"text-xs text-white/60",children:"PNG, JPG, GIF"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 sm:pt-6",children:[e.jsx("button",{type:"button",onClick:()=>{d("/EventDashboard")},className:"px-4 sm:px-5 py-2 sm:py-2.5 rounded-lg bg-white/10 text-white text-sm sm:text-base hover:bg-white/20 transition-colors duration-200",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:y,className:"px-4 sm:px-6 py-2 sm:py-2.5 rounded-lg bg-gradient-to-r from-[#9b1f62] to-[#682161] text-white text-sm sm:text-base font-medium shadow-lg hover:opacity-90 transition-all duration-200 "+(y?"opacity-70 cursor-not-allowed":""),children:y?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),m?"Saving...":"Creating..."]}):m?"Save Changes":"Create Event"})]})]})]})})})}export{o as default};
