import{j as e,l as t}from"./index-CNBhnEaq.js";import{r,u as s}from"./react-vendor-BU_GpymC.js";import{s as n,n as i}from"./notifications-GebQcT5-.js";import{s as a}from"./session-DbMe381v.js";function o(){const[o,l]=r.useState(""),[d,u]=r.useState(""),[c,h]=r.useState(null),[m,x]=r.useState("username"),[f,p]=r.useState(null),[g,w]=r.useState(!1),b=s(),v=r.useRef(null),j=r.useRef(null);r.useEffect((()=>{"username"===m&&v.current?v.current.focus():"password"===m&&j.current&&j.current.focus()}),[m]);return e.jsx("div",{className:"min-h-screen bg-gradient-to-r from-[#9b1f62] via-[#682161] to-[#3e3764] flex items-center justify-center px-4 py-8",children:e.jsx("div",{className:"bg-white/10 backdrop-blur-md w-full max-w-md sm:max-w-lg rounded-2xl shadow-xl overflow-hidden",children:e.jsxs("div",{className:"p-6 sm:p-8",children:[e.jsx("h2",{className:"text-2xl sm:text-3xl font-bold text-white text-center mb-6",children:"Sign in with StudyNet Account"}),e.jsx("br",{}),"username"===m?e.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e=o.includes("@")?o:`${o}@studynetglobal.com`;h(e),x("password"),p(null)})()},className:"space-y-5",children:[f&&e.jsx("div",{className:"bg-red-500/20 border border-red-500/50 text-white px-4 py-3 rounded-lg text-sm",children:f}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:v,type:"text",placeholder:"Email or Username",value:o,onChange:e=>l(e.target.value),className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/30 transition text-sm sm:text-base",required:!0}),e.jsx("button",{type:"submit",className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white",children:e.jsx("svg",{className:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})})]})]}):e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),w(!0),p(null);try{t.info("Attempting authentication...");const{data:e,error:r}=await n.auth.signInWithPassword({email:c,password:d});if(r)return t.error("Authentication error:",r),void p("Invalid credentials. Please try again.");if(!e.user)return t.error("No user data returned from auth"),void p("An unexpected error occurred during login.");t.info("Authentication successful. User ID:",{userId:e.user.id}),t.info("Fetching user data...");const{data:s,error:o}=await n.from("users").select().eq("id",e.user.id).single();if(o)return t.error("Error fetching user data:",{error:o}),void p("Error fetching user data. Please try again.");if(!s)return t.error("No user found in users table"),void p("User not found in database. Please contact support.");t.info("User data fetched successfully:",{userData:s}),t.info("Updating last sign in timestamp...",{timestamp:(new Date).toISOString()});const l=(new Date).toISOString(),{error:u}=await n.from("users").update({last_sign_in:l}).eq("id",e.user.id);u?t.error("Error updating last sign in:",{error:f}):(t.info("Last sign in updated successfully to:",{timestamp:l}),s.last_sign_in=l),t.info("Initializing session..."),await a.initSession(s),t.info("Navigation to dashboard..."),b("/EventDashboard"),i.success("Successfully logged in!")}catch(r){t.error("Unexpected error during login:",r),p("An unexpected error occurred during login.")}finally{w(!1)}},className:"space-y-5",children:[f&&e.jsx("div",{className:"bg-red-500/20 border border-red-500/50 text-white px-4 py-3 rounded-lg text-sm",children:f}),"              ",e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between text-white text-sm gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{x("username"),u(""),p(null)},className:"flex items-center gap-2 hover:underline w-fit",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),"Change email"]}),e.jsx("span",{className:"text-white/80 break-words sm:text-right",children:c})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:j,type:"password",placeholder:"Enter your password",value:d,onChange:e=>u(e.target.value),className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-white/30 transition text-sm sm:text-base",required:!0}),e.jsx("button",{type:"submit",disabled:g,className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-white",children:g?e.jsxs("svg",{className:"w-5 h-5 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}):e.jsx("svg",{className:"w-5 h-5",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M5 12h14M12 5l7 7-7 7"})})})]})]})]})})})}export{o as default};
